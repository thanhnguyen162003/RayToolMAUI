@inherits LayoutComponentBase
@inject IAuthenticationService AuthService
@inject NavigationManager Navigation
@inject ISnackbar Snackbar

<MudThemeProvider Theme="_theme" IsDarkMode="true" />
<MudPopoverProvider />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout>
    <AuthorizeView>
        <Authorized>
            <MudAppBar Elevation="1">
                <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" OnClick="@((e) => DrawerToggle())" />
                <MudText Typo="Typo.h5" Class="ml-3">RayTools</MudText>
                <MudSpacer />
                <MudIconButton Icon="@Icons.Material.Filled.Logout" Color="Color.Inherit" OnClick="Logout" Title="Logout" />
            </MudAppBar>
            <MudDrawer @bind-Open="_drawerOpen" ClipMode="DrawerClipMode.Always" Elevation="2">
                <MudNavMenu>
                    <MudNavLink Href="@AppConstants.Routes.Dashboard" Icon="@Icons.Material.Filled.Dashboard" Match="NavLinkMatch.All">Dashboard</MudNavLink>
                    
                    <MudNavGroup Title="Networking" Icon="@Icons.Material.Filled.NetworkCheck" Expanded="true">
                        <MudNavLink Href="@AppConstants.Routes.PortScanner" Icon="@Icons.Material.Filled.Scanner">Port Scanner</MudNavLink>
                        <MudNavLink Href="@AppConstants.Routes.IpLookup" Icon="@Icons.Material.Filled.Search">IP Lookup</MudNavLink>
                        <MudNavLink Href="@AppConstants.Routes.PingTool" Icon="@Icons.Material.Filled.NetworkCell">Ping Tool</MudNavLink>
                        <MudNavLink Href="@AppConstants.Routes.DnsLookup" Icon="@Icons.Material.Filled.Dns">DNS Lookup</MudNavLink>
                        <MudNavLink Href="@AppConstants.Routes.MyPublicIp" Icon="@Icons.Material.Filled.Public">My Public IP</MudNavLink>
                        <MudDivider Class="my-2"/>
                        <MudNavLink Href="@AppConstants.Routes.SubnetCalculator" Icon="@Icons.Material.Filled.Calculate">Subnet Calculator</MudNavLink>
                        <MudNavLink Href="@AppConstants.Routes.TraceRoute" Icon="@Icons.Material.Filled.Route">Trace Route</MudNavLink>
                        <MudNavLink Href="@AppConstants.Routes.WhoisLookup" Icon="@Icons.Material.Filled.ContactPage">Whois Lookup</MudNavLink>
                        <MudNavLink Href="@AppConstants.Routes.MacLookup" Icon="@Icons.Material.Filled.DeviceHub">MAC Lookup</MudNavLink>
                    </MudNavGroup>
                    
                    <MudNavGroup Title="Cloud & DevOps" Icon="@Icons.Material.Filled.Cloud" Expanded="true">
                        <MudNavLink Href="@AppConstants.Routes.CloudLatency" Icon="@Icons.Material.Filled.Speed">Cloud Latency</MudNavLink>
                        <MudNavLink Href="@AppConstants.Routes.SslAuditor" Icon="@Icons.Material.Filled.Lock">SSL Auditor</MudNavLink>
                        <MudNavLink Href="@AppConstants.Routes.HeaderAnalyzer" Icon="@Icons.Material.Filled.Security">Header Analyzer</MudNavLink>
                    </MudNavGroup>
                    
                    <MudNavGroup Title="Developer Utilities" Icon="@Icons.Material.Filled.Code" Expanded="true">
                        <MudNavLink Href="@AppConstants.Routes.JwtDecoder" Icon="@Icons.Material.Filled.VpnKey">JWT Decoder</MudNavLink>
                        <MudNavLink Href="@AppConstants.Routes.JsonFormatter" Icon="@Icons.Material.Filled.FormatAlignLeft">JSON/XML Formatter</MudNavLink>
                        <MudNavLink Href="@AppConstants.Routes.Base64Converter" Icon="@Icons.Material.Filled.SwapHoriz">Base64 Converter</MudNavLink>
                    </MudNavGroup>
                </MudNavMenu>
            </MudDrawer>
            <MudMainContent>
                <MudContainer MaxWidth="MaxWidth.Large" Class="mt-4">
                    @Body
                </MudContainer>
            </MudMainContent>
        </Authorized>
        <NotAuthorized>
            <MudMainContent>
                <div class="d-flex justify-center align-center" style="height: 100vh;">
                    @Body
                </div>
            </MudMainContent>
        </NotAuthorized>
    </AuthorizeView>
</MudLayout>

@code {
    bool _drawerOpen = true;

    void DrawerToggle()
    {
        _drawerOpen = !_drawerOpen;
    }

    private MudTheme _theme = new()
    {
        PaletteLight = new PaletteLight()
        {
            Primary = "#1e88e5",
            Secondary = "#1565c0",
            AppbarBackground = "#0d47a1",
            Background = "#121212",
            Surface = "#1e1e1e",
            DrawerBackground = "#1a1a1a",
            DrawerText = "rgba(255,255,255, 0.87)",
            AppbarText = "rgba(255,255,255, 0.87)",
            TextPrimary = "rgba(255,255,255, 0.87)",
            TextSecondary = "rgba(255,255,255, 0.60)",
            ActionDefault = "#1e88e5",
            ActionDisabled = "rgba(255,255,255, 0.26)",
            ActionDisabledBackground = "rgba(255,255,255, 0.12)",
            Divider = "rgba(255,255,255, 0.12)",
            DividerLight = "rgba(255,255,255, 0.06)",
            TableLines = "rgba(255,255,255, 0.12)",
            LinesDefault = "rgba(255,255,255, 0.12)",
            LinesInputs = "rgba(255,255,255, 0.3)",
            TextDisabled = "rgba(255,255,255, 0.38)"
        }
    };

    private async Task Logout()
    {
        await AuthService.LogoutAsync();
        Snackbar.Add("Logged out successfully", Severity.Info);
        Navigation.NavigateTo(AppConstants.Routes.Login, true);
    }
}
